# P2048 è¶…çº§é’¢ç´ - ç®—æ³•å¯¹æ¯”åˆ†æ

## ğŸ” é—®é¢˜æ ¸å¿ƒ

P2048æ˜¯ä¸€é“"é€‰æ‹©kä¸ªæœ€å¤§å­æ®µå’Œ"çš„ç»å…¸é—®é¢˜ï¼Œæ ¸å¿ƒåœ¨äºï¼š
1. åœ¨é•¿åº¦é™åˆ¶ä¸º[L,R]çš„æ‰€æœ‰è¿ç»­å­æ®µä¸­
2. é€‰æ‹©kä¸ªä¸åŒçš„å­æ®µ
3. ä½¿å¾—æ€»å’Œæœ€å¤§

## ğŸš€ ä¸¤ç§ä¸»è¦ç®—æ³•å®ç°

### 1. ä¸»å¸­æ ‘ + å † + è´ªå¿ƒ (P2048.cpp)

#### ç®—æ³•æ€è·¯
- **ä¸»å¸­æ ‘**ï¼šç»´æŠ¤å‰ç¼€å’Œçš„å¯æŒä¹…åŒ–æƒå€¼çº¿æ®µæ ‘ï¼Œæ”¯æŒåŒºé—´ç¬¬kå¤§æŸ¥è¯¢
- **å †è´ªå¿ƒ**ï¼šç»´æŠ¤æ‰€æœ‰å¯èƒ½çš„å€™é€‰åŒºé—´ï¼Œæ¯æ¬¡é€‰æ‹©å…¨å±€æœ€å¤§
- **åŒºé—´åˆ†è£‚**ï¼šé€‰æ‹©ä¸€ä¸ªåŒºé—´åï¼Œå°†å…¶"åˆ†è£‚"ä¸ºä¸‹ä¸€ä¸ªæ¬¡å¤§åŒºé—´

#### æ ¸å¿ƒä¼˜åŠ¿
- **é«˜æ•ˆæŸ¥è¯¢**ï¼šO(log n)æ—¶é—´æŸ¥è¯¢åŒºé—´ç¬¬kå¤§
- **ç©ºé—´æ¢æ—¶é—´**ï¼šé€šè¿‡å¯æŒä¹…åŒ–æ•°æ®ç»“æ„å®ç°é«˜æ•ˆæŸ¥è¯¢
- **ç†è®ºæœ€ä¼˜**ï¼šæ—¶é—´å¤æ‚åº¦O(n log n + k log k)

#### ä»£ç ç‰¹ç‚¹
```cpp
// ä¸»å¸­æ ‘æŸ¥è¯¢ç¬¬kå¤§
long long query(int rt1, int rt2, int k, int l, int r) {
    if (l == r) return b[l];
    int mid = (l + r) >> 1;
    int cnt = tree[tree[rt1].rs].cnt - tree[tree[rt2].rs].cnt;
    if (k <= cnt) {
        return query(tree[rt1].rs, tree[rt2].rs, k, mid + 1, r);
    } else {
        return query(tree[rt1].ls, tree[rt2].ls, k - cnt, l, mid);
    }
}
```

### 2. STè¡¨ + åŒºé—´åˆ†è£‚ + å † (P2048_ST.cpp)

#### ç®—æ³•æ€è·¯
- **STè¡¨ç»´æŠ¤RMQ**ï¼šO(1)æŸ¥è¯¢ä»»æ„åŒºé—´çš„æœ€å¤§å‰ç¼€å’ŒåŠå…¶ä½ç½®
- **å †ç»´æŠ¤å€™é€‰**ï¼šåŠ¨æ€ç»´æŠ¤å½“å‰æ‰€æœ‰å¯èƒ½çš„æœ€ä¼˜åŒºé—´
- **æ™ºèƒ½åˆ†è£‚**ï¼šæ¯æ¬¡é€‰æ‹©ä¸€ä¸ªåŒºé—´åï¼Œæ ¹æ®æœ€å¤§å€¼ä½ç½®å°†å…¶åˆ†è£‚æˆä¸¤ä¸ªå­åŒºé—´

#### æ ¸å¿ƒç‰¹ç‚¹
- **åŠ¨æ€åˆ†è£‚**ï¼šé¿å…é¢„å¤„ç†æ‰€æœ‰å¯èƒ½çš„åŒºé—´
- **ä½ç½®è¿½è¸ª**ï¼šSTè¡¨åŒæ—¶ç»´æŠ¤æœ€å¤§å€¼å’Œä½ç½®ä¿¡æ¯
- **æœ€ä¼˜å¤æ‚åº¦**ï¼šè¾¾åˆ°O(n log n + k log k)ç†è®ºæœ€ä¼˜

#### ä»£ç ç‰¹ç‚¹
```cpp
// STè¡¨æŸ¥è¯¢åŒºé—´æœ€å¤§å€¼åŠä½ç½®
pair<long long, int> query_max_with_pos(int l, int r) {
    int len = r - l + 1;
    int k = lg[len];
    
    if (st[l][k] >= st[r - (1 << k) + 1][k]) {
        return make_pair(st[l][k], st_pos[l][k]);
    } else {
        return make_pair(st[r - (1 << k) + 1][k], st_pos[r - (1 << k) + 1][k]);
    }
}

// æ™ºèƒ½åŒºé—´åˆ†è£‚
// æ‰¾åˆ°æœ€å¤§å€¼ä½ç½®ååˆ†è£‚ä¸ºä¸¤ä¸ªå­åŒºé—´
int max_pos = query_max_with_pos(left_bound, right_bound).second;
// åˆ†è£‚ä¸º[left_bound, max_pos-1] å’Œ [max_pos+1, right_bound]
```

## ğŸ“Š å¤æ‚åº¦å¯¹æ¯”

| ç®—æ³• | æ—¶é—´å¤æ‚åº¦ | ç©ºé—´å¤æ‚åº¦ | é¢„å¤„ç†æ—¶é—´ | æŸ¥è¯¢æ•ˆç‡ |
|------|------------|------------|------------|----------|
| ä¸»å¸­æ ‘ç‰ˆ | O(n log V + k log V) | O(n log V) | O(n log V) | O(log V) |
| STè¡¨ç‰ˆ | O(n log n + k log k) | O(n log n) | O(n log n) | O(1) |

å…¶ä¸­Væ˜¯å€¼åŸŸå¤§å°ã€‚

## ğŸ¯ ç®—æ³•é€‰æ‹©å»ºè®®

### æ•°æ®è§„æ¨¡è€ƒè™‘

**ä¸­å°è§„æ¨¡æ•°æ® (n â‰¤ 100000)**
- **æ¨è**ï¼šSTè¡¨ç‰ˆ
- **åŸå› **ï¼šå®ç°ç®€å•ï¼Œå¤æ‚åº¦ä¼˜ç§€
- **ç‰¹ç‚¹**ï¼šä»£ç æ¸…æ™°ï¼Œè°ƒè¯•å®¹æ˜“

**å¤§è§„æ¨¡æ•°æ® (n â‰¤ 500000, å€¼åŸŸå¾ˆå¤§)**
- **æ¨è**ï¼šä¸»å¸­æ ‘ç‰ˆ
- **åŸå› **ï¼šç†è®ºæœ€ä¼˜å¤æ‚åº¦ï¼Œé€‚åˆå¤§å€¼åŸŸ
- **ç‰¹ç‚¹**ï¼šå¯æŒä¹…åŒ–ç»“æ„ï¼ŒåŠŸèƒ½å¼ºå¤§

### ç«èµ›ç­–ç•¥

**NOI/çœé€‰çº§åˆ«**
- **é¦–é€‰ä¸»å¸­æ ‘ç‰ˆ**ï¼šä½“ç°ç®—æ³•æ·±åº¦ï¼Œé€‚åˆé«˜éš¾åº¦ç«èµ›
- **å¤‡é€‰STè¡¨ç‰ˆ**ï¼šå®ç°ç›¸å¯¹ç®€å•ï¼Œæ€§èƒ½ä¼˜ç§€

**æ™®é€šç«èµ›**
- **é¦–é€‰STè¡¨ç‰ˆ**ï¼šå¿«é€Ÿå®ç°ï¼Œå®¹é”™ç‡é«˜
- **ç‰¹ç‚¹**ï¼šæ€è·¯æ¸…æ™°ï¼Œä¸å®¹æ˜“å‡ºé”™

## ğŸ’¡ æ ¸å¿ƒæ€æƒ³å¯¹æ¯”

### ä¸»å¸­æ ‘çš„ä¼˜åŠ¿
```cpp
// æ ¸å¿ƒï¼šå¯æŒä¹…åŒ–æƒå€¼çº¿æ®µæ ‘ï¼Œæ”¯æŒå†å²ç‰ˆæœ¬æŸ¥è¯¢
// æ¯ä¸ªç‰ˆæœ¬è®°å½•ä¸€ä¸ªå‰ç¼€çš„å…ƒç´ åˆ†å¸ƒæƒ…å†µ
// å¯ä»¥å¿«é€ŸæŸ¥è¯¢ä»»æ„åŒºé—´çš„ç¬¬kå¤§å…ƒç´ 
```

### STè¡¨çš„ä¼˜åŠ¿
```cpp
// æ ¸å¿ƒï¼šRMQ + åŒºé—´åˆ†è£‚ï¼Œæ”¯æŒO(1)åŒºé—´æœ€å€¼æŸ¥è¯¢å’Œä½ç½®å®šä½
// é€šè¿‡æ™ºèƒ½åˆ†è£‚é¿å…é¢„å¤„ç†æ‰€æœ‰å¯èƒ½çš„åŒºé—´
// åŠ¨æ€ç»´æŠ¤å€™é€‰åŒºé—´ï¼Œè¾¾åˆ°æœ€ä¼˜å¤æ‚åº¦
```

### è´ªå¿ƒç­–ç•¥çš„é€šç”¨æ€§
```cpp
// æ ¸å¿ƒæ€æƒ³ï¼šç»´æŠ¤æ‰€æœ‰å¯èƒ½çš„"ä¸‹ä¸€ä¸ªæœ€å¤§å€¼"
// æ¯æ¬¡é€‰æ‹©å…¨å±€æœ€å¤§çš„ï¼Œç„¶åæ™ºèƒ½åˆ†è£‚äº§ç”Ÿæ–°å€™é€‰
// ä¿è¯ä¸é—æ¼ä»»ä½•å¯èƒ½çš„æœ€ä¼˜è§£
```

## ğŸ† å®é™…è¡¨ç°

### æµ‹è¯•ç»“æœå¯¹æ¯”

**æ ·ä¾‹æµ‹è¯•**ï¼š
- ä¸¤ä¸ªç‰ˆæœ¬éƒ½æ­£ç¡®è¾“å‡º`11`
- æ€§èƒ½å·®å¼‚åœ¨å¾®ç§’çº§åˆ«ï¼Œéš¾ä»¥åŒºåˆ†

**å¤æ‚æµ‹è¯•**ï¼š
- ä¸»å¸­æ ‘ç‰ˆï¼šç¨³å®šé«˜æ•ˆï¼Œå†…å­˜ä½¿ç”¨è¾ƒå¤§
- STè¡¨ç‰ˆï¼šåŠ¨æ€åˆ†è£‚ï¼ŒæŸ¥è¯¢å’Œæ›´æ–°éƒ½å¾ˆå¿«é€Ÿ

### ä»£ç å¤æ‚åº¦
- **ä¸»å¸­æ ‘ç‰ˆ**ï¼šä»£ç é‡æœ€å¤§ï¼ŒæŠ€æœ¯å«é‡æœ€é«˜
- **STè¡¨ç‰ˆ**ï¼šä»£ç é‡é€‚ä¸­ï¼Œé€»è¾‘æ¸…æ™°ï¼Œå®ç°éš¾åº¦é€‚ä¸­

## ğŸ“ å­¦ä¹ å»ºè®®

### ç®—æ³•å­¦ä¹ è·¯å¾„
1. **å…ˆç†è§£STè¡¨ç‰ˆ**ï¼šæŒæ¡åŒºé—´åˆ†è£‚çš„æ ¸å¿ƒæ€æƒ³
2. **å†å­¦ä¹ ä¸»å¸­æ ‘ç‰ˆ**ï¼šæ·±å…¥ç†è§£å¯æŒä¹…åŒ–æ•°æ®ç»“æ„
3. **å¯¹æ¯”åˆ†æ**ï¼šç†è§£ä¸¤ç§æ–¹æ³•çš„é€‚ç”¨åœºæ™¯

### ç«èµ›å‡†å¤‡
- **ç†Ÿç»ƒæŒæ¡ä¸»å¸­æ ‘**ï¼šåº”å¯¹é«˜éš¾åº¦é¢˜ç›®
- **ç†Ÿç»ƒæŒæ¡STè¡¨**ï¼šå¿«é€Ÿè§£å†³RMQç±»é—®é¢˜
- **ç†è§£è´ªå¿ƒæœ¬è´¨**ï¼šé€‚ç”¨äºå¤šç§ç±»ä¼¼é—®é¢˜
- **æŒæ¡åŒºé—´åˆ†è£‚**ï¼šåˆ›æ–°çš„ç®—æ³•è®¾è®¡æ€æƒ³

---

*ä¸¤ç§ç®—æ³•å„æœ‰ä¼˜åŠ¿ï¼Œä¸»å¸­æ ‘å±•ç°äº†æ•°æ®ç»“æ„çš„æ·±åº¦ï¼ŒSTè¡¨ä½“ç°äº†ç®—æ³•è®¾è®¡çš„å·§æ€ï¼*  
*é€‰æ‹©æœ€é€‚åˆçš„æ‰æ˜¯æœ€å¥½çš„ï¼Œç®—æ³•ç«èµ›ä¸ä»…è¦è¿½æ±‚æ­£ç¡®ï¼Œæ›´è¦è¿½æ±‚ä¼˜é›…ï¼ğŸŒ¸* 