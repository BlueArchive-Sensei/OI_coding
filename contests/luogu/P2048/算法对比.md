# P2048 è¶…çº§é’¢ç´ - ç®—æ³•å¯¹æ¯”åˆ†æž

## ðŸ” é—®é¢˜æ ¸å¿ƒ

P2048æ˜¯ä¸€é“"é€‰æ‹©kä¸ªæœ€å¤§å­æ®µå’Œ"çš„ç»å…¸é—®é¢˜ï¼Œæ ¸å¿ƒåœ¨äºŽï¼š
1. åœ¨é•¿åº¦é™åˆ¶ä¸º[L,R]çš„æ‰€æœ‰è¿žç»­å­æ®µä¸­
2. é€‰æ‹©kä¸ªä¸åŒçš„å­æ®µ
3. ä½¿å¾—æ€»å’Œæœ€å¤§

## ðŸš€ ä¸‰ç§ä¸»è¦ç®—æ³•å®žçŽ°

### 1. ä¸»å¸­æ ‘ + å † + è´ªå¿ƒ (P2048.cpp)

#### ç®—æ³•æ€è·¯
- **ä¸»å¸­æ ‘**ï¼šç»´æŠ¤å‰ç¼€å’Œçš„å¯æŒä¹…åŒ–æƒå€¼çº¿æ®µæ ‘ï¼Œæ”¯æŒåŒºé—´ç¬¬kå¤§æŸ¥è¯¢
- **å †è´ªå¿ƒ**ï¼šç»´æŠ¤æ‰€æœ‰å¯èƒ½çš„å€™é€‰åŒºé—´ï¼Œæ¯æ¬¡é€‰æ‹©å…¨å±€æœ€å¤§
- **åŒºé—´åˆ†è£‚**ï¼šé€‰æ‹©ä¸€ä¸ªåŒºé—´åŽï¼Œå°†å…¶"åˆ†è£‚"ä¸ºä¸‹ä¸€ä¸ªæ¬¡å¤§åŒºé—´

#### æ ¸å¿ƒä¼˜åŠ¿
- **é«˜æ•ˆæŸ¥è¯¢**ï¼šO(log n)æ—¶é—´æŸ¥è¯¢åŒºé—´ç¬¬kå¤§
- **ç©ºé—´æ¢æ—¶é—´**ï¼šé€šè¿‡å¯æŒä¹…åŒ–æ•°æ®ç»“æž„å®žçŽ°é«˜æ•ˆæŸ¥è¯¢
- **ç†è®ºæœ€ä¼˜**ï¼šæ—¶é—´å¤æ‚åº¦O(n log n + k log k)

#### ä»£ç ç‰¹ç‚¹
```cpp
// ä¸»å¸­æ ‘æŸ¥è¯¢ç¬¬kå¤§
long long query(int rt1, int rt2, int k, int l, int r) {
    if (l == r) return b[l];
    int mid = (l + r) >> 1;
    int cnt = tree[tree[rt1].rs].cnt - tree[tree[rt2].rs].cnt;
    if (k <= cnt) {
        return query(tree[rt1].rs, tree[rt2].rs, k, mid + 1, r);
    } else {
        return query(tree[rt1].ls, tree[rt2].ls, k - cnt, l, mid);
    }
}
```

### 2. STè¡¨ + å † + è´ªå¿ƒ (P2048_ST.cpp)

#### ç®—æ³•æ€è·¯
- **STè¡¨**ï¼šç»´æŠ¤å‰ç¼€å’Œçš„RMQ(åŒºé—´æœ€å¤§å€¼æŸ¥è¯¢)
- **é¢„å¤„ç†**ï¼šä¸ºæ¯ä¸ªå·¦ç«¯ç‚¹é¢„å¤„ç†æ‰€æœ‰å¯èƒ½çš„åŒºé—´å¹¶æŽ’åº
- **å †è´ªå¿ƒ**ï¼šä»Žé¢„å¤„ç†çš„ç»“æžœä¸­é€‰æ‹©kä¸ªæœ€å¤§å€¼

#### æ ¸å¿ƒç‰¹ç‚¹
- **RMQä¼˜åŒ–**ï¼šO(1)æ—¶é—´æŸ¥è¯¢åŒºé—´æœ€å¤§å€¼
- **ç©ºé—´é¢„å¤„ç†**ï¼šé¢„å…ˆè®¡ç®—æ‰€æœ‰å¯èƒ½çš„åŒºé—´
- **å®žçŽ°ç®€å•**ï¼šé€»è¾‘æ¸…æ™°ï¼Œå®¹æ˜“ç†è§£

#### ä»£ç ç‰¹ç‚¹
```cpp
// STè¡¨æŸ¥è¯¢åŒºé—´æœ€å¤§å€¼
long long query_max(int l, int r) {
    int len = r - l + 1;
    int k = lg[len];
    return max(st[l][k], st[r - (1 << k) + 1][k]);
}

// é¢„å¤„ç†æ‰€æœ‰åŒºé—´
vector<HeapNode> get_intervals(int left) {
    vector<HeapNode> intervals;
    for (int right = min_right; right <= max_right; right++) {
        long long val = sum[right] - sum[left - 1];
        intervals.push_back({val, left, right});
    }
    sort(intervals.rbegin(), intervals.rend());
    return intervals;
}
```

### 3. STè¡¨ä¼˜åŒ–ç‰ˆ + å † + è´ªå¿ƒ (P2048_ST_optimized.cpp)

#### ç®—æ³•æ€è·¯
- **STè¡¨åˆå§‹åŒ–**ï¼šå¿«é€Ÿæ‰¾åˆ°æ¯ä¸ªå·¦ç«¯ç‚¹çš„æœ€ä¼˜åŒºé—´
- **åŠ¨æ€æŸ¥è¯¢**ï¼šéœ€è¦æ—¶æ‰è®¡ç®—ç¬¬kå¤§åŒºé—´
- **æ··åˆç­–ç•¥**ï¼šç»“åˆSTè¡¨çš„å¿«é€ŸæŸ¥è¯¢å’ŒåŠ¨æ€è®¡ç®—

#### æ ¸å¿ƒç‰¹ç‚¹
- **å¯å‘å¼ä¼˜åŒ–**ï¼šç”¨STè¡¨å¿«é€Ÿæ‰¾åˆ°æœ€ä¼˜è§£
- **å»¶è¿Ÿè®¡ç®—**ï¼šé¿å…ä¸å¿…è¦çš„é¢„å¤„ç†
- **å¹³è¡¡ç­–ç•¥**ï¼šåœ¨æ—¶é—´å’Œç©ºé—´ä¹‹é—´æ‰¾å¹³è¡¡

## ðŸ“Š å¤æ‚åº¦å¯¹æ¯”

| ç®—æ³• | æ—¶é—´å¤æ‚åº¦ | ç©ºé—´å¤æ‚åº¦ | é¢„å¤„ç†æ—¶é—´ | æŸ¥è¯¢æ•ˆçŽ‡ |
|------|------------|------------|------------|----------|
| ä¸»å¸­æ ‘ç‰ˆ | O(n log n + k log k) | O(n log n) | O(n log n) | O(log n) |
| STè¡¨ç‰ˆ | O(nÂ·R + k log k) | O(n log n + nÂ·R) | O(nÂ·R) | O(1) |
| STè¡¨ä¼˜åŒ–ç‰ˆ | O(n log n + kÂ·R) | O(n log n) | O(n log n) | O(R) |

å…¶ä¸­R = R - L + 1æ˜¯åŒºé—´é•¿åº¦èŒƒå›´ã€‚

## ðŸŽ¯ ç®—æ³•é€‰æ‹©å»ºè®®

### æ•°æ®è§„æ¨¡è€ƒè™‘

**å°è§„æ¨¡æ•°æ® (n â‰¤ 1000, R â‰¤ 100)**
- **æŽ¨è**ï¼šSTè¡¨ç‰ˆ
- **åŽŸå› **ï¼šå®žçŽ°ç®€å•ï¼Œé¢„å¤„ç†å¼€é”€å°
- **ç‰¹ç‚¹**ï¼šä»£ç æ¸…æ™°ï¼Œæ˜“äºŽè°ƒè¯•

**ä¸­ç­‰è§„æ¨¡æ•°æ® (n â‰¤ 50000, R â‰¤ 1000)**
- **æŽ¨è**ï¼šSTè¡¨ä¼˜åŒ–ç‰ˆ
- **åŽŸå› **ï¼šå¹³è¡¡äº†æ—¶é—´å’Œç©ºé—´
- **ç‰¹ç‚¹**ï¼šé¿å…è¿‡åº¦é¢„å¤„ç†ï¼ŒåŠ¨æ€è®¡ç®—

**å¤§è§„æ¨¡æ•°æ® (n â‰¤ 500000, R â‰¤ n)**
- **æŽ¨è**ï¼šä¸»å¸­æ ‘ç‰ˆ
- **åŽŸå› **ï¼šç†è®ºæœ€ä¼˜å¤æ‚åº¦
- **ç‰¹ç‚¹**ï¼šé€‚åˆå¤„ç†å¤§æ•°æ®ï¼ŒæŸ¥è¯¢æ•ˆçŽ‡é«˜

### ç«žèµ›ç­–ç•¥

**NOI/çœé€‰çº§åˆ«**
- **é¦–é€‰ä¸»å¸­æ ‘ç‰ˆ**ï¼šä½“çŽ°ç®—æ³•æ·±åº¦
- **å¤‡é€‰STè¡¨ä¼˜åŒ–ç‰ˆ**ï¼šå®žçŽ°ç›¸å¯¹ç®€å•

**æ™®é€šç«žèµ›**
- **é¦–é€‰STè¡¨ç‰ˆ**ï¼šå¿«é€Ÿå®žçŽ°ï¼Œå®¹é”™çŽ‡é«˜
- **ç‰¹ç‚¹**ï¼šæ€è·¯ç›´è§‚ï¼Œä¸å®¹æ˜“å‡ºé”™

## ðŸ’¡ æ ¸å¿ƒæ€æƒ³å¯¹æ¯”

### ä¸»å¸­æ ‘çš„ä¼˜åŠ¿
```cpp
// æ ¸å¿ƒï¼šå¯æŒä¹…åŒ–æƒå€¼çº¿æ®µæ ‘ï¼Œæ”¯æŒåŽ†å²ç‰ˆæœ¬æŸ¥è¯¢
// æ¯ä¸ªç‰ˆæœ¬è®°å½•ä¸€ä¸ªå‰ç¼€çš„å…ƒç´ åˆ†å¸ƒæƒ…å†µ
// å¯ä»¥å¿«é€ŸæŸ¥è¯¢ä»»æ„åŒºé—´çš„ç¬¬kå¤§å…ƒç´ 
```

### STè¡¨çš„ä¼˜åŠ¿
```cpp
// æ ¸å¿ƒï¼šé¢„å¤„ç†RMQï¼Œæ”¯æŒO(1)åŒºé—´æœ€å€¼æŸ¥è¯¢
// é€‚åˆåŒºé—´æœ€å€¼é—®é¢˜ï¼Œä½†ä¸æ”¯æŒç¬¬kå¤§æŸ¥è¯¢
// éœ€è¦é…åˆå…¶ä»–æ–¹æ³•æ¥å¤„ç†ç¬¬kå¤§é—®é¢˜
```

### è´ªå¿ƒç­–ç•¥çš„é€šç”¨æ€§
```cpp
// æ ¸å¿ƒæ€æƒ³ï¼šç»´æŠ¤æ‰€æœ‰å¯èƒ½çš„"ä¸‹ä¸€ä¸ªæœ€å¤§å€¼"
// æ¯æ¬¡é€‰æ‹©å…¨å±€æœ€å¤§çš„ï¼Œç„¶åŽæ›´æ–°å€™é€‰é›†åˆ
// ä¿è¯ä¸é—æ¼ä»»ä½•å¯èƒ½çš„æœ€ä¼˜è§£
```

## ðŸ† å®žé™…è¡¨çŽ°

### æµ‹è¯•ç»“æžœå¯¹æ¯”

**æ ·ä¾‹æµ‹è¯•**ï¼š
- æ‰€æœ‰ç‰ˆæœ¬éƒ½æ­£ç¡®è¾“å‡º`11`
- æ€§èƒ½å·®å¼‚åœ¨å¾®ç§’çº§åˆ«ï¼Œéš¾ä»¥åŒºåˆ†

**å¤æ‚æµ‹è¯•**ï¼š
- ä¸»å¸­æ ‘ç‰ˆï¼šç¨³å®šé«˜æ•ˆï¼Œå†…å­˜ä½¿ç”¨è¾ƒå¤§
- STè¡¨ç‰ˆï¼šé¢„å¤„ç†æ—¶é—´è¾ƒé•¿ï¼ŒæŸ¥è¯¢å¿«é€Ÿ
- STè¡¨ä¼˜åŒ–ç‰ˆï¼šå¹³è¡¡è¡¨çŽ°ï¼Œé€‚ä¸­çš„æ—¶ç©ºå¼€é”€

### ä»£ç å¤æ‚åº¦
- **ä¸»å¸­æ ‘ç‰ˆ**ï¼šä»£ç é‡æœ€å¤§ï¼ŒæŠ€æœ¯å«é‡æœ€é«˜
- **STè¡¨ç‰ˆ**ï¼šä»£ç é‡ä¸­ç­‰ï¼Œé€»è¾‘æœ€æ¸…æ™°
- **STè¡¨ä¼˜åŒ–ç‰ˆ**ï¼šä»£ç é‡é€‚ä¸­ï¼Œå®žçŽ°éš¾åº¦å¹³è¡¡

## ðŸŽ“ å­¦ä¹ å»ºè®®

### ç®—æ³•å­¦ä¹ è·¯å¾„
1. **å…ˆç†è§£STè¡¨ç‰ˆ**ï¼šæŽŒæ¡åŸºæœ¬æ€è·¯å’Œè´ªå¿ƒç­–ç•¥
2. **å†å­¦ä¹ ä¸»å¸­æ ‘ç‰ˆ**ï¼šæ·±å…¥ç†è§£å¯æŒä¹…åŒ–æ•°æ®ç»“æž„
3. **æœ€åŽä¼˜åŒ–STè¡¨ç‰ˆ**ï¼šå­¦ä¼šåœ¨ä¸åŒæ–¹æ¡ˆé—´åšæƒè¡¡

### ç«žèµ›å‡†å¤‡
- **ç†Ÿç»ƒæŽŒæ¡ä¸»å¸­æ ‘**ï¼šåº”å¯¹é«˜éš¾åº¦é¢˜ç›®
- **ç†Ÿç»ƒæŽŒæ¡STè¡¨**ï¼šå¿«é€Ÿè§£å†³RMQç±»é—®é¢˜
- **ç†è§£è´ªå¿ƒæœ¬è´¨**ï¼šé€‚ç”¨äºŽå¤šç§ç±»ä¼¼é—®é¢˜

---

*ä¸åŒçš„ç®—æ³•å„æœ‰ä¼˜åŠ¿ï¼Œé€‰æ‹©æœ€é€‚åˆçš„æ‰æ˜¯æœ€å¥½çš„ï¼*  
*ç®—æ³•ç«žèµ›ä¸ä»…è¦è¿½æ±‚æ­£ç¡®ï¼Œæ›´è¦è¿½æ±‚ä¼˜é›…ï¼ðŸŒ¸* 